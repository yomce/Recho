# 비디오 처리 로직

| 헷갈리는 video처리 로직을 정리하기 위해 작성하는 마크다운입니다.

## WEB (react)

### 영상 썸네일

마이 페이지에 id로 영상의 썸네일을 찾아야 함.

---

### 영상 스트리밍

s3에 저장된 링크만 받아서 스트리밍

한 번에 좋아요 순으로 10개씩 받아서 렌더링 하기.

더이상 없으면 없다는 응답 보내기.

---

### 영상편집 트리거

**case 1. 생성**

백엔드 호출 없음.

**case 2. 레이어 쌓기**

RN의 [영상 불러오기](##영상\불러오기)를 수행 후 편집화면으로 넘어감(RN에서 수행)

but 스트리밍 되고 있는 영상의 ID를 넘겨줘야 함.
대신 이때 db서칭은 수행하지 않고 rn에 아이디만 넘겨 주면됨.

---

## APP (react native)

### 영상 편집하기

[영상 편집트리거](###영상편집\트리거)가 case2인 경우 영상을 불러와야함.

#### 영상 불러오기

넘겨 받은 영상의 ID로 depth만큼 for문 돌려서 부모 아이디로 소스 영상 찾기

const parId = 넘겨 받은 영상의 id.
const depth -> 부모의 수

depth == 2 -> 부모가 있고 부모의 부모도 있다는 듯이므로
이때 부터 반복문을 돌면 됨.

why? 넘겨 받은 영상의 id가 결국은 부모이기 때문

** 해당 영상의 presignedURL을 백엔드로 부터 받아서 s3에서 직접 소스 영상을 꺼내오기 **

db에 저장

- 처음 넘겨 받은 영상의 Id가 부모 비디오 Id

---

### 영상편집 후 업로드

기존 디바이스 저장으로 되어 있음.
이 부분을 presignedURL로 직접 보내면 됨.
이후 db에 해당 정보 저장

## SERVER (nest)

받는 요청

- web

  - user_id -> 썸네일
  - 좋아요 순 -> 10개씩의 결과 영상 url

- app

  - video_id -> parent_video_id, depth, s3 에서 소스비디오를 가져올 수 있는 presignedURL

  - video_id(부모 아이디 였던 것) -> parent_video_id, s3 에서 소스비디오를 가져올 수 있는 presignedURL

  - 영상편집 후 업로드 로직 적용.

보내는 요청

- 소스, 썸네일, 결과 영상을 각각 저장할 s3의 presignedURL주소
- 소스 영상을 찾아올 s3의 presignedURL
